

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using Spack to build Key4HEP software &mdash; Key4HEP  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/panels.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels.css" type="text/css" />
  <link rel="stylesheet" href="../_static/starterkit.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Building Key4hep Software on Arch Linux with spack" href="spack-arch.html" />
    <link rel="prev" title="Getting started with Key4HEP software" href="../setup-and-getting-started/README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Key4HEP
          

          
            
            <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../setup-and-getting-started/README.html">Getting started with Key4HEP software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../setup-and-getting-started/README.html#setting-up-the-key4hep-software-stack">Setting up the Key4HEP Software Stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../setup-and-getting-started/README.html#using-central-installations-on-cvmfs">Using central installations on cvmfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../setup-and-getting-started/README.html#using-virtual-machines-or-docker-containers">Using Virtual Machines or Docker containers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../setup-and-getting-started/README.html#cernvm-virtual-appliance">CernVM Virtual Appliance</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using Spack to build Key4HEP software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-a-central-buildcache">Using a central buildcache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spack-arch.html">Building Key4hep Software on Arch Linux with spack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../talks-and-presentations/README.html">Talks and Presentations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../talks-and-presentations/README.html#upcoming-talks-and-workshops">Upcoming Talks and Workshops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../call-for-logos/README.html">Call for logos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://cern.ch/fccsw">FCC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/CLIC/CLICSoftwareComputing">CLIC software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ilcsoft.desy.de/portal">ILC software</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cepcsoft.ihep.ac.cn/">CEPC software</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Key4HEP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Using Spack to build Key4HEP software</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/key4hep/key4hep-doc/blob/master/spack-build-instructions/README.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="using-spack-to-build-key4hep-software">
<h1>Using Spack to build Key4HEP software<a class="headerlink" href="#using-spack-to-build-key4hep-software" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://spack.io">spack</a> package manager can be used to build the Key4HEP software stack.</p>
<p>Spack can be installed by simply cloning it with git. The spack repository for key4hep packages is installed the same way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/spack/spack.git
git clone https://github.com/key4hep/k4-spack.git
<span class="nb">alias</span> <span class="nv">spack</span><span class="o">=</span><span class="s1">&#39;python $PWD/spack/bin/spack&#39;</span>

spack repo add k4-spack

<span class="c1"># install the meta-package for the key4hep-stack</span>
spack install key4hep-stack
</pre></div>
</div>
<div class="section" id="using-a-central-buildcache">
<h2>Using a central buildcache<a class="headerlink" href="#using-a-central-buildcache" title="Permalink to this headline">¶</a></h2>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="spack-documentation"><i class="fa fa-info-circle"></i> Spack documentation</p>
</div>
<div class="panel-body docutils container">
<p>For more information refer to the <a class="reference external" href="https://spack.readthedocs.io/en/latest/binary_caches.html">spack documentation</a>.</p>
</div>
</div>
<p>It is possible to relocate and  re-use  binaries with the so-called buildcache.
Some central buildcaches are on the key4hep <code class="docutils literal notranslate"><span class="pre">eos</span></code> space under:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/eos/project/k/key4hep/www/key4hep/spack_build/mirror/spackages
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">spackages</span></code> is intended as the central buildcache for key4hep packages built from scratch,
but there exist other buildcaches for packages built against the LCG releases, and rolling builds that are using the branchname <code class="docutils literal notranslate"><span class="pre">master</span></code> or other moving targets.
All packages versioned <code class="docutils literal notranslate"><span class="pre">package&#64;master</span></code> are treated by spack as the same version, even if master points to different commits, thus they must be installed to separate directories, ideally indicating the date.
A buildcache called <code class="docutils literal notranslate"><span class="pre">contrib</span></code> is intended for build tools such as compilers.
Spack automatically creates subdirectory for different platforms and compiler versions.</p>
<p>For write permissions to this space, subscribe to the egroup <code class="docutils literal notranslate"><span class="pre">cernbox-project-key4hep-writers</span></code>.</p>
<p>The following command can be used to put packages into the buildcache:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># key4hep-stack was already installed with &#39;spack install key4hep-stack&#39;
spack mirror add key4hep /eos/project/k/key4hep/www/key4hep/spack_build/mirror/spackages
spack buildcache create -m key4hep -u -a -f key4hep-stack
</pre></div>
</div>
<p>Since the packages need to be relocated as well as copied, this might take up to an hour.</p>
<p>In order to install packages from the  buildcache, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>spack buildcache install -u -a key4hep-stack
</pre></div>
</div>
<p>Spack will then search all added mirrors for <code class="docutils literal notranslate"><span class="pre">key4hep-stack</span></code>.
For read-only access on machines without <code class="docutils literal notranslate"><span class="pre">eos</span></code>, these files are served also over http:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>spack mirror add key4hep-web http://key4hep.web.cern.ch/key4hep/spack_build/mirror/spackages/
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="spack-arch.html" class="btn btn-neutral float-right" title="Building Key4hep Software on Arch Linux with spack" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../setup-and-getting-started/README.html" class="btn btn-neutral float-left" title="Getting started with Key4HEP software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Key4HEP

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>